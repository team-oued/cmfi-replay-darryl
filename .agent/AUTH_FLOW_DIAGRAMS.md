# Flux d'authentification - Diagrammes

## Flux Sign Up (Inscription)

### 1. Sign Up avec Email/Password

```
┌─────────────────────────────────────────────────────────────────┐
│                    UTILISATEUR                                   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Écran Sign Up   │
                    └──────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Remplit le formulaire:       │
              │  - Nom complet                │
              │  - Email                      │
              │  - Mot de passe               │
              └───────────────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Clic "Get       │
                    │   Started"       │
                    └──────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    FIREBASE AUTH                                 │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  createUserWithEmailAndPassword│
              │  Crée le compte Auth          │
              └───────────────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Retourne UID    │
                    └──────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    FIRESTORE                                     │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Crée document dans           │
              │  collection "users"           │
              │                               │
              │  {                            │
              │    uid: "...",                │
              │    email: "...",              │
              │    display_name: "...",       │
              │    created_time: "23 nov...", │
              │    presence: "offline",       │
              │    hasAcceptedPrivacyPolicy:  │
              │      false,                   │
              │    theme: "dark",             │
              │    language: "en",            │
              │    bookmarkedIds: []          │
              │  }                            │
              └───────────────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Connexion       │
                    │  automatique     │
                    └──────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Redirection     │
                    │  vers Home       │
                    └──────────────────┘
```

### 2. Sign Up avec Google

```
┌─────────────────────────────────────────────────────────────────┐
│                    UTILISATEUR                                   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Écran Sign Up   │
                    └──────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Clic "Continue with Google"  │
              └───────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    GOOGLE OAUTH                                  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Popup/Redirect Google        │
              │  Sélection du compte          │
              └───────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    FIREBASE AUTH                                 │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  signInWithPopup/Redirect     │
              │  Authentification Google      │
              └───────────────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Retourne User   │
                    │  avec infos      │
                    │  Google          │
                    └──────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Vérifie si profil existe     │
              │  dans Firestore               │
              └───────────────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │                   │
                   OUI                 NON
                    │                   │
                    │                   ▼
                    │     ┌───────────────────────────────┐
                    │     │  Crée profil Firestore        │
                    │     │  avec infos Google:           │
                    │     │  - displayName                │
                    │     │  - photoURL                   │
                    │     │  - email                      │
                    │     └───────────────────────────────┘
                    │                   │
                    └─────────┬─────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Connexion       │
                    │  automatique     │
                    └──────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Redirection     │
                    │  vers Home       │
                    └──────────────────┘
```

---

## Flux Forgot Password (Réinitialisation)

```
┌─────────────────────────────────────────────────────────────────┐
│                    UTILISATEUR                                   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Écran Login     │
                    └──────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Clic "Forgot Password?"      │
              └───────────────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Écran Forgot    │
                    │  Password        │
                    └──────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Entre son email              │
              └───────────────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Clic "Send      │
                    │  Reset Link"     │
                    └──────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    FIREBASE AUTH                                 │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  sendPasswordResetEmail()     │
              └───────────────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │                   │
              Email existe        Email n'existe pas
                    │                   │
                    │                   │
                    └─────────┬─────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Envoie email (ou simule)     │
              │  Message de succès affiché    │
              │  (pour la sécurité)           │
              └───────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    EMAIL PROVIDER                                │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Email envoyé avec:           │
              │  - Lien sécurisé              │
              │  - Valide 1 heure             │
              │  - Instructions               │
              └───────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    UTILISATEUR                                   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Ouvre l'email                │
              │  Clic sur le lien             │
              └───────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    FIREBASE RESET PAGE                           │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Page de réinitialisation     │
              │  Firebase                     │
              └───────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Entre nouveau mot de passe   │
              │  (2 fois pour confirmation)   │
              └───────────────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Validation      │
                    └──────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    FIREBASE AUTH                                 │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Met à jour le mot de passe   │
              │  dans Firebase Auth           │
              └───────────────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Confirmation    │
                    │  de succès       │
                    └──────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    UTILISATEUR                                   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Retour à l'app               │
              │  Connexion avec nouveau MDP   │
              └───────────────────────────────┘
```

---

## États et transitions

### AuthScreen - États possibles

```
┌─────────────────────────────────────────────────────────────────┐
│                    AuthScreen Component                          │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  authMode: 'login' (défaut)   │
              └───────────────────────────────┘
                              │
                    ┌─────────┼─────────┐
                    │         │         │
                    ▼         ▼         ▼
              ┌─────────┐ ┌────────┐ ┌──────────────┐
              │  login  │ │ signup │ │forgotPassword│
              └─────────┘ └────────┘ └──────────────┘
                    │         │         │
                    │         │         ▼
                    │         │    ┌──────────────┐
                    │         │    │resetRequested│
                    │         │    │  true/false  │
                    │         │    └──────────────┘
                    │         │         │
                    └─────────┴─────────┴─────────┐
                                                  │
                                                  ▼
                                      ┌───────────────────┐
                                      │  Authenticated    │
                                      │  Redirect to Home │
                                      └───────────────────┘
```

### Gestion des erreurs

```
┌─────────────────────────────────────────────────────────────────┐
│                    Erreur détectée                               │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  setError(message)            │
              │  setAuthLoading(false)        │
              └───────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Affichage message d'erreur   │
              │  (rouge, en haut du form)     │
              └───────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Utilisateur corrige          │
              │  et réessaie                  │
              └───────────────────────────────┘
```

---

## Légende

```
┌─────────┐
│  Bloc   │  = Étape du processus
└─────────┘

    │
    ▼        = Flux séquentiel

    ┌─┴─┐
    │   │    = Branchement conditionnel
    ▼   ▼

═══════════  = Séparation entre systèmes
```
